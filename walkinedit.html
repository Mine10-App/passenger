<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Approval System</title>
    <style>
        :root {
            --primary-gold: #c8a951;
            --gold-dark: #b89436;
            --gold-light: #e8d9a9;
            --gold-accent: #d4b44a;
            --gold-bg: #fefbf0;
            --success: #52c41a;
            --warning: #faad14;
            --danger: #ff4d4f;
            --text-dark: #262626;
            --text-light: #8c8c8c;
            --border-light: #f0f0f0;
            --border: #d9d9d9;
            --white: #ffffff;
            --background: #fafafa;
            --shadow: 0 2px 8px rgba(200, 169, 81, 0.1);
            --shadow-lg: 0 4px 16px rgba(200, 169, 81, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--background);
            color: var(--text-dark);
            line-height: 1.6;
        }

        .app-container {
            min-height: 100vh;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        .app-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 0;
        }

        .app-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-gold);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            text-shadow: 0 2px 4px rgba(200, 169, 81, 0.2);
        }

        .app-subtitle {
            font-size: 1.1rem;
            color: var(--text-light);
            font-weight: 400;
        }

        /* User Info */
        .user-info {
            margin-top: 10px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        /* Card Styles */
        .search-card,
        .transaction-card,
        .supervisor-card {
            background: var(--white);
            border-radius: 12px;
            box-shadow: var(--shadow);
            border: 1px solid var(--gold-light);
            margin-bottom: 24px;
            overflow: hidden;
        }

        .supervisor-card {
            border: 2px solid var(--warning);
        }

        .search-header,
        .card-header {
            background: linear-gradient(135deg, var(--primary-gold), var(--gold-dark));
            color: var(--white);
            padding: 24px;
        }

        .search-header h2,
        .card-header h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .search-header p {
            opacity: 0.9;
            font-size: 0.95rem;
        }

        /* Supervisor Section */
        .supervisor-content {
            padding: 24px;
            background: rgba(250, 173, 20, 0.05);
        }

        .field-selection {
            display: flex;
            gap: 16px;
            align-items: end;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }

        .field-selection label {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 8px;
            display: block;
        }

        .field-select {
            padding: 12px 16px;
            border: 2px solid var(--warning);
            border-radius: 8px;
            background: var(--white);
            font-size: 1rem;
            min-width: 200px;
            flex: 1;
            max-width: 300px;
        }

        .permissions-info {
            padding: 12px 16px;
            background: var(--white);
            border-radius: 6px;
            border-left: 4px solid var(--success);
        }

        .permissions-info p {
            margin: 0;
            font-size: 0.9rem;
            color: var(--text-dark);
        }

        /* Search Controls */
        .search-controls {
            padding: 32px 24px;
            background: var(--gold-bg);
        }

        .search-input-group {
            display: flex;
            gap: 12px;
            max-width: 600px;
            margin: 0 auto;
        }

        .search-input {
            flex: 1;
            padding: 16px 20px;
            border: 2px solid var(--gold-light);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--white);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-gold);
            box-shadow: 0 0 0 3px rgba(200, 169, 81, 0.1);
        }

        .search-button {
            padding: 16px 32px;
            background: var(--primary-gold);
            color: var(--white);
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .search-button:hover {
            background: var(--gold-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        /* Transaction Section */
        .transaction-content {
            padding: 32px;
            background: var(--gold-bg);
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
            padding: 20px;
            background: var(--white);
            border-radius: 8px;
            border: 1px solid var(--gold-light);
        }

        .info-group label {
            display: block;
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 4px;
            font-weight: 500;
        }

        .info-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-dark);
        }

        .info-value.amount {
            color: var(--primary-gold);
            font-size: 1.3rem;
        }

        /* Details Grid */
        .details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            margin-bottom: 32px;
        }

        .detail-section {
            background: var(--white);
            padding: 24px;
            border: 1px solid var(--gold-light);
            border-radius: 8px;
        }

        .detail-section h4 {
            font-size: 1.1rem;
            color: var(--primary-gold);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--gold-light);
        }

        .editable-field {
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .field-editable {
            border-left: 4px solid var(--success);
            background: rgba(82, 196, 26, 0.05);
        }

        .field-supervisor {
            border-left: 4px solid var(--warning);
            background: rgba(250, 173, 20, 0.05);
        }

        .field-locked {
            border-left: 4px solid var(--border);
            background: #f8f9fa;
        }

        .payment-field {
            border-left: 4px solid var(--primary-gold) !important;
            background: rgba(200, 169, 81, 0.05) !important;
        }

        .hidden-field {
            display: none;
        }

        .calculation-field {
            border-left: 4px solid var(--primary-gold);
            background: rgba(200, 169, 81, 0.05);
        }

        .required-field {
            border-left: 4px solid var(--danger);
            background: rgba(255, 77, 79, 0.05);
        }

        .optional-field {
            border-left: 4px solid var(--warning);
            background: rgba(250, 173, 20, 0.05);
        }

        .editable-field label {
            display: block;
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 6px;
            font-weight: 500;
        }

        .detail-input,
        .detail-select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--white);
        }

        .detail-input:read-only,
        .detail-select:disabled {
            background: #f8f9fa;
            color: var(--text-light);
            border-color: var(--border-light);
        }

        .detail-input:focus,
        .detail-select:focus {
            outline: none;
            border-color: var(--primary-gold);
            box-shadow: 0 0 0 3px rgba(200, 169, 81, 0.1);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
            padding-top: 24px;
            border-top: 1px solid var(--gold-light);
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary-gold);
            color: var(--white);
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--gold-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .btn-secondary {
            background: var(--warning);
            color: var(--white);
        }

        .btn-secondary:hover:not(:disabled) {
            background: #d48806;
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }

        .btn-danger:hover:not(:disabled) {
            background: #d9363e;
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .btn-outline {
            background: transparent;
            color: var(--text-light);
            border: 2px solid var(--gold-light);
        }

        .btn-outline:hover {
            background: var(--gold-bg);
            border-color: var(--primary-gold);
            color: var(--primary-gold);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Status Badge */
        .receipt-badge {
            display: inline-block;
            padding: 6px 16px;
            background: var(--white);
            color: var(--primary-gold);
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 12px;
            border: 1px solid var(--gold-light);
        }

        /* Loading State */
        .loading-state {
            text-align: center;
            padding: 60px 20px;
            background: var(--gold-bg);
            border-radius: 12px;
            margin: 20px 0;
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--gold-light);
            border-top: 4px solid var(--primary-gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 80px 20px;
            background: var(--gold-bg);
            border-radius: 12px;
            margin: 20px 0;
            border: 2px dashed var(--gold-light);
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
            color: var(--primary-gold);
        }

        .empty-state h3 {
            color: var(--text-light);
            margin-bottom: 12px;
        }

        .empty-state p {
            color: var(--text-light);
        }

        /* Receipt Print */
        .receipt-print {
            display: none;
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            box-shadow: var(--shadow-lg);
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success {
            background: var(--success);
        }

        .toast.error {
            background: var(--danger);
        }

        .toast.warning {
            background: var(--warning);
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: var(--white);
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary-gold), var(--gold-dark));
            color: var(--white);
            padding: 20px;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 1.3rem;
        }

        .close {
            font-size: 1.5rem;
            cursor: pointer;
            font-weight: bold;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-body textarea,
        .modal-body input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-family: inherit;
            font-size: 1rem;
            resize: vertical;
            margin-top: 10px;
        }

        .modal-body textarea:focus,
        .modal-body input:focus {
            outline: none;
            border-color: var(--primary-gold);
            box-shadow: 0 0 0 3px rgba(200, 169, 81, 0.1);
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--border-light);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .app-container {
                padding: 16px;
            }

            .app-title {
                font-size: 2rem;
            }

            .search-input-group {
                flex-direction: column;
            }

            .details-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                justify-content: center;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            .field-selection {
                flex-direction: column;
                align-items: stretch;
            }

            .field-select {
                min-width: auto;
            }
        }

        @media print {
            body * {
                visibility: hidden;
            }
            .receipt-print,
            .receipt-print * {
                visibility: visible;
            }
            .receipt-print {
                position: absolute;
                left: 0;
                top: 0;
                width: 80mm;
            }
        }
    </style>
    
    <!-- Your Firebase Configuration -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="fireW.js"></script> <!-- shift / main DB -->
    <script src="fireC.js"></script> <!-- walkin payments / walkinDb -->
    <script src="Co.js"></script>
    <script src="rate.js"></script> <!-- Rate calculations -->
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <h1 class="app-title">
                    <i class="icon">💳</i>
                    Payment Approval System
                </h1>
                <p class="app-subtitle">Process and manage non-cash transactions</p>
                <div class="user-info" id="userInfo">
                    <span id="userLevel">Loading...</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Search Section -->
            <section class="search-section">
                <div class="search-card">
                    <div class="search-header">
                        <h2>Find Transaction</h2>
                        <p>Enter receipt number to load transaction details</p>
                    </div>
                    <div class="search-controls">
                        <div class="search-input-group">
                            <input 
                                type="text" 
                                id="receiptSearch" 
                                placeholder="Enter Receipt Number (e.g., 2)" 
                                class="search-input"
                            >
                            <button id="searchBtn" class="search-button">
                                <span class="button-text">Search</span>
                                <i class="search-icon">🔍</i>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Supervisor Controls Section -->
            <section class="supervisor-section" id="supervisorSection" style="display: none;">
                <div class="supervisor-card">
                    <div class="card-header">
                        <h3>Supervisor Controls</h3>
                        <p>Select fields to edit and fetch additional data</p>
                    </div>
                    <div class="supervisor-content">
                        <div class="field-selection">
                            <label>Select Field to Edit:</label>
                            <select id="fieldSelector" class="field-select">
                                <option value="">-- Select Field --</option>
                                <option value="all">All Fields</option>
                                <option value="name">Customer Name</option>
                                <option value="flightNo">Flight Number</option>
                                <option value="airline">Airline</option>
                                <option value="seatNo">Seat Number</option>
                                <option value="adults">Adults</option>
                                <option value="kids">Kids</option>
                                <option value="rateType">Rate Type</option>
                                <option value="currency">Currency</option>
                                <option value="paymentDetails">Payment Details (Subtotal, GST, Balance)</option>
                            </select>
                            <button id="fetchDataBtn" class="btn btn-secondary">
                                <i class="btn-icon">🔄</i>
                                Fetch & Edit Selected Field
                            </button>
                        </div>
                        <div class="permissions-info">
                            <p><strong>Permissions:</strong> All users can edit Payment Type, Approval Code, and Batch No. Supervisor can fetch and edit additional fields.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Transaction Details -->
            <section class="transaction-section" id="transactionSection" style="display: none;">
                <div class="transaction-card">
                    <div class="card-header">
                        <h3>Transaction Details</h3>
                        <div class="receipt-badge" id="receiptBadge"></div>
                    </div>
                    
                    <div class="transaction-content">
                        <!-- Basic Info -->
                        <div class="info-grid">
                            <div class="info-group">
                                <label>Receipt Number</label>
                                <div class="info-value" id="infoReceiptNo">-</div>
                            </div>
                            <div class="info-group">
                                <label>Date & Time</label>
                                <div class="info-value" id="infoDateTime">-</div>
                            </div>
                            <div class="info-group">
                                <label>Cashier</label>
                                <div class="info-value" id="infoCashier">-</div>
                            </div>
                            <div class="info-group">
                                <label>Total Amount</label>
                                <div class="info-value amount" id="infoTotalAmount">$0.00</div>
                            </div>
                        </div>

                        <!-- Customer & Flight Info -->
                        <div class="details-grid">
                            <div class="detail-section">
                                <h4>Customer Information</h4>
                                <div class="editable-field hidden-field" id="nameField">
                                    <label>Name</label>
                                    <input type="text" id="inputName" class="detail-input" readonly>
                                </div>
                                <div class="editable-field hidden-field" id="flightNoField">
                                    <label>Flight Number</label>
                                    <input type="text" id="inputFlightNo" class="detail-input" readonly>
                                </div>
                                <div class="editable-field hidden-field" id="airlineField">
                                    <label>Airline</label>
                                    <input type="text" id="inputAirline" class="detail-input" readonly>
                                </div>
                                <div class="editable-field hidden-field" id="seatNoField">
                                    <label>Seat Number</label>
                                    <input type="text" id="inputSeatNo" class="detail-input" readonly>
                                </div>
                                <div class="editable-field hidden-field" id="adultsField">
                                    <label>Adults</label>
                                    <input type="number" id="inputAdults" class="detail-input" min="0" value="0">
                                </div>
                                <div class="editable-field hidden-field" id="kidsField">
                                    <label>Kids</label>
                                    <input type="number" id="inputKids" class="detail-input" min="0" value="0">
                                </div>
                                <div class="editable-field hidden-field" id="rateTypeField">
                                    <label>Rate Type</label>
                                    <select id="inputRateType" class="detail-select">
                                        <option value="A">Rate A</option>
                                        <option value="B">Rate B</option>
                                    </select>
                                </div>
                                <div class="editable-field hidden-field" id="currencyField">
                                    <label>Currency</label>
                                    <select id="inputCurrency" class="detail-select">
                                        <option value="USD">USD</option>
                                        <option value="MVR">MVR</option>
                                    </select>
                                </div>
                                <div class="fetch-message" id="fetchMessage" style="display: block;">
                                    <p style="color: var(--text-light); font-style: italic; text-align: center;">
                                        Use supervisor controls to fetch customer information
                                    </p>
                                </div>
                            </div>

                            <div class="detail-section">
                                <h4>Payment Details</h4>
                                <div class="editable-field payment-field" id="paymentTypeField">
                                    <label>Payment Type</label>
                                    <select id="selectPaymentType" class="detail-select">
                                        <option value="Cash">Cash</option>
                                        <option value="Card">Card</option>
                                        <option value="Visa">Visa</option>
                                        <option value="Master">MasterCard</option>
                                        <option value="Amex">American Express</option>
                                        <option value="Unionpay">UnionPay</option>
                                        <option value="Mobile Pay">Mobile Payment</option>
                                    </select>
                                </div>
                                <div class="editable-field payment-field required-field" id="approvalCodeField">
                                    <label>Approval Code <small style="color: var(--danger);">(Required for Card)</small></label>
                                    <input type="text" id="inputApprovalCode" class="detail-input" placeholder="Enter approval code">
                                </div>
                                <div class="editable-field payment-field required-field" id="batchNoField">
                                    <label>Batch No <small style="color: var(--danger);">(Required for Card)</small></label>
                                    <input type="text" id="inputBatchNo" class="detail-input" placeholder="Enter batch number">
                                </div>
                                <div class="editable-field payment-field" id="amountField">
                                    <label>Amount Paid</label>
                                    <input type="number" id="inputAmount" class="detail-input" step="0.01" min="0">
                                </div>
                                
                                <!-- Payment Calculation Fields (Hidden Initially) -->
                                <div class="editable-field hidden-field calculation-field" id="subtotalField">
                                    <label>Subtotal</label>
                                    <input type="number" id="inputSubtotal" class="detail-input" readonly>
                                </div>
                                <div class="editable-field hidden-field calculation-field" id="gstField">
                                    <label>GST</label>
                                    <input type="number" id="inputGst" class="detail-input" readonly>
                                </div>
                                <div class="editable-field hidden-field calculation-field" id="grandTotalField">
                                    <label>Grand Total</label>
                                    <input type="number" id="inputGrandTotal" class="detail-input" readonly>
                                </div>
                                <div class="editable-field hidden-field calculation-field" id="balanceField">
                                    <label>Balance</label>
                                    <input type="number" id="inputBalance" class="detail-input" readonly>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="action-buttons">
                            <button id="saveBtn" class="btn btn-primary">
                                <i class="btn-icon">💾</i>
                                Save Changes
                            </button>
                            <button id="voidBtn" class="btn btn-danger">
                                <i class="btn-icon">🗑️</i>
                                Void Transaction
                            </button>
                            <button id="newSearchBtn" class="btn btn-outline">
                                <i class="btn-icon">🔍</i>
                                New Search
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Loading State -->
            <div class="loading-state" id="loadingState" style="display: none;">
                <div class="loading-spinner"></div>
                <p>Searching for transaction...</p>
            </div>

            <!-- Empty State -->
            <div class="empty-state" id="emptyState" style="display: none;">
                <div class="empty-icon">📄</div>
                <h3>No Transaction Found</h3>
                <p>Please check the receipt number and try again</p>
            </div>
        </main>

        <!-- Receipt Print Section -->
        <div id="receipt" class="receipt-print"></div>
    </div>

    <!-- Void Reason Modal -->
    <div id="voidModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Void Transaction</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <p>Please provide a reason for voiding this transaction:</p>
                <textarea id="voidReason" placeholder="Enter reason for voiding..." rows="4"></textarea>
            </div>
            <div class="modal-footer">
                <button id="confirmVoid" class="btn btn-danger">Confirm Void</button>
                <button id="cancelVoid" class="btn btn-outline">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        class PaymentApproval {
            constructor() {
                // Use your existing Firebase instances
                this.walkinDb = window.walkinDb; // From fireC.js
                this.currentTransaction = null;
                this.currentUser = JSON.parse(localStorage.getItem("loggedInUser")) || {
                    username: "Abdulla Irufan",
                    level: "Supervisor" // Default to Supervisor for testing
                };
                this.isSupervisor = false;
                this.hasSupervisorAccess = false;
                this.supervisorPassword = "super123";
                this.customerDataFetched = false;
                this.paymentDetailsFetched = false;
                
                // Rate configuration (from rate.js)
                this.rates = window.rates || {
                    AdultAUSD: { price: 35.00, GST: 8, WP: "Leeli" },
                    KidsAUSD: { price: 25.00, GST: 8, WP: "Leeli" },
                    AdultAMVR: { price: 539.70, GST: 8, WP: "Leeli" },
                    KidsAMVR: { price: 385.50, GST: 8, WP: "Leeli" },
                    AdultBUSD: { price: 24.31, GST: 8, WP: "Leeli" },
                    KidsBUSD: { price: 24.31, GST: 8, WP: "Leeli" },
                    AdultBMVR: { price: 374.80, GST: 8, WP: "Leeli" },
                    KidsBMVR: { price: 374.80, GST: 8, WP: "Leeli" }
                };
                
                this.init();
            }

            async init() {
                if (!this.walkinDb) {
                    console.error('Walkin database not initialized. Please check fireC.js');
                    this.showError('Database not initialized. Please check your connection.');
                    return;
                }

                await this.checkUserLevel();
                this.bindEvents();
                this.focusSearch();
                this.displayUserInfo();
            }

            async checkUserLevel() {
                try {
                    // Get current logged in user
                    const currentUsername = this.currentUser.username;
                    
                    if (!currentUsername) {
                        console.log('No user logged in');
                        return;
                    }

                    // Check if users array is available from Co.js
                    if (typeof users !== 'undefined' && Array.isArray(users)) {
                        const user = users.find(u => u.username === currentUsername);
                        if (user) {
                            this.isSupervisor = user.Level === 'Supervisor';
                            console.log(`User ${currentUsername} is ${this.isSupervisor ? 'Supervisor' : 'User'}`);
                            return;
                        }
                    }

                    // Fallback: Check user level from localStorage or default to User
                    this.isSupervisor = this.currentUser.level === 'Supervisor' || this.currentUser.Level === 'Supervisor';
                    
                } catch (error) {
                    console.error('Error checking user level:', error);
                    this.isSupervisor = false;
                }
            }

            displayUserInfo() {
                const userInfo = document.getElementById('userInfo');
                const level = this.isSupervisor ? 'Supervisor' : 'User';
                userInfo.innerHTML = `User: ${this.currentUser.username || 'Unknown'} | Level: ${level}`;
            }

            bindEvents() {
                // Search functionality
                document.getElementById('searchBtn').addEventListener('click', () => this.searchTransaction());
                document.getElementById('receiptSearch').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.searchTransaction();
                });

                // Action buttons
                document.getElementById('saveBtn').addEventListener('click', () => this.saveTransaction());
                document.getElementById('voidBtn').addEventListener('click', () => this.showVoidModal());
                document.getElementById('newSearchBtn').addEventListener('click', () => this.resetSearch());

                // Supervisor controls
                document.getElementById('fetchDataBtn').addEventListener('click', () => this.fetchSelectedField());
                
                // Payment type change event
                document.getElementById('selectPaymentType').addEventListener('change', () => this.handlePaymentTypeChange());
                
                // Calculation fields event listeners
                this.bindCalculationEvents();
                
                // Modal events
                document.querySelectorAll('.close').forEach(closeBtn => {
                    closeBtn.addEventListener('click', () => this.hideAllModals());
                });
                
                document.getElementById('cancelVoid').addEventListener('click', () => this.hideAllModals());
                document.getElementById('confirmVoid').addEventListener('click', () => this.voidTransaction());

                // Close modals when clicking outside
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) this.hideAllModals();
                    });
                });

                // Auto-enable payment fields for all users
                this.enablePaymentFields();
            }

            handlePaymentTypeChange() {
                const paymentType = document.getElementById('selectPaymentType').value;
                const isCardPayment = paymentType !== 'Cash';
                
                // Show/hide card-specific fields
                const approvalCodeField = document.getElementById('approvalCodeField');
                const batchNoField = document.getElementById('batchNoField');
                
                if (isCardPayment) {
                    // Card payment - show and require approval code and batch no
                    approvalCodeField.style.display = 'block';
                    batchNoField.style.display = 'block';
                    approvalCodeField.className = 'editable-field payment-field required-field';
                    batchNoField.className = 'editable-field payment-field required-field';
                    
                    // Auto-set amount paid to grand total for card payments
                    const grandTotal = parseFloat(document.getElementById('inputGrandTotal').value) || 0;
                    if (grandTotal > 0) {
                        document.getElementById('inputAmount').value = grandTotal.toFixed(2);
                        this.calculateBalance();
                    }
                } else {
                    // Cash payment - hide approval code and batch no
                    approvalCodeField.style.display = 'none';
                    batchNoField.style.display = 'none';
                    
                    // Reset values for cash payments
                    document.getElementById('inputApprovalCode').value = '';
                    document.getElementById('inputBatchNo').value = '';
                }
                
                console.log('Payment type changed to:', paymentType, 'isCardPayment:', isCardPayment);
            }

            bindCalculationEvents() {
                // Bind events for calculation fields
                const calculationFields = ['inputAdults', 'inputKids', 'inputRateType', 'inputCurrency'];
                calculationFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.addEventListener('change', () => this.calculateTotals());
                        field.addEventListener('input', () => this.calculateTotals());
                    }
                });

                // Also bind to amount paid for balance calculation
                const amountField = document.getElementById('inputAmount');
                if (amountField) {
                    amountField.addEventListener('input', () => this.calculateBalance());
                }
            }

            calculateTotals() {
                if (!this.customerDataFetched) return;

                const adults = parseInt(document.getElementById('inputAdults').value) || 0;
                const kids = parseInt(document.getElementById('inputKids').value) || 0;
                const rateType = document.getElementById('inputRateType').value;
                const currency = document.getElementById('inputCurrency').value;

                if (adults === 0 && kids === 0) {
                    this.clearCalculations();
                    return;
                }

                // Calculate based on rates
                const adultRateKey = `Adult${rateType}${currency}`;
                const kidsRateKey = `Kids${rateType}${currency}`;

                const adultRate = this.rates[adultRateKey];
                const kidsRate = this.rates[kidsRateKey];

                if (!adultRate || !kidsRate) {
                    this.showError(`Rate not found for ${rateType}${currency}`);
                    return;
                }

                // Calculate subtotal
                const adultSubtotal = adults * adultRate.price;
                const kidsSubtotal = kids * kidsRate.price;
                const subtotal = adultSubtotal + kidsSubtotal;

                // Calculate GST (using adult rate GST percentage)
                const gstRate = adultRate.GST / 100;
                const gst = subtotal * gstRate;

                // Calculate grand total
                const grandTotal = subtotal + gst;

                // Update fields
                document.getElementById('inputSubtotal').value = subtotal.toFixed(2);
                document.getElementById('inputGst').value = gst.toFixed(2);
                document.getElementById('inputGrandTotal').value = grandTotal.toFixed(2);

                // Update basic info display
                const currencySymbol = currency === 'MVR' ? 'MVR ' : '$';
                document.getElementById('infoTotalAmount').textContent = `${currencySymbol}${grandTotal.toFixed(2)}`;

                // Auto-set amount paid for card payments
                const paymentType = document.getElementById('selectPaymentType').value;
                if (paymentType !== 'Cash') {
                    document.getElementById('inputAmount').value = grandTotal.toFixed(2);
                }

                // Calculate balance
                this.calculateBalance();

                console.log('Calculated totals:', { subtotal, gst, grandTotal, adults, kids, rateType, currency });
            }

            calculateBalance() {
                if (!this.paymentDetailsFetched) return;

                const grandTotal = parseFloat(document.getElementById('inputGrandTotal').value) || 0;
                const amountPaid = parseFloat(document.getElementById('inputAmount').value) || 0;
                const balance = amountPaid - grandTotal;

                document.getElementById('inputBalance').value = balance.toFixed(2);
            }

            clearCalculations() {
                document.getElementById('inputSubtotal').value = '0.00';
                document.getElementById('inputGst').value = '0.00';
                document.getElementById('inputGrandTotal').value = '0.00';
                document.getElementById('inputBalance').value = '0.00';
                document.getElementById('infoTotalAmount').textContent = '$0.00';
            }

            enablePaymentFields() {
                // Payment fields are always editable for all users
                const paymentFields = ['selectPaymentType', 'inputApprovalCode', 'inputBatchNo', 'inputAmount'];
                paymentFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.readOnly = false;
                        field.disabled = false;
                    }
                });
            }

            focusSearch() {
                document.getElementById('receiptSearch').focus();
            }

            async searchTransaction() {
                const receiptInput = document.getElementById('receiptSearch').value.trim();
                
                if (!receiptInput) {
                    this.showError('Please enter a receipt number');
                    return;
                }

                // Convert to number since receiptNo is stored as number
                const receiptNo = parseInt(receiptInput);
                if (isNaN(receiptNo)) {
                    this.showError('Please enter a valid receipt number');
                    return;
                }

                this.showLoading();
                this.hideTransaction();
                this.hideEmptyState();
                this.hideSupervisorSection();

                try {
                    // Search for transaction in Firebase using your walkinDb
                    const snapshot = await this.walkinDb.collection('payments')
                        .where('receiptNo', '==', receiptNo)
                        .limit(1)
                        .get();

                    if (snapshot.empty) {
                        this.showEmptyState();
                        return;
                    }

                    const doc = snapshot.docs[0];
                    this.currentTransaction = {
                        id: doc.id,
                        ...doc.data()
                    };

                    console.log('Transaction data:', this.currentTransaction);
                    this.displayBasicTransaction();
                    
                } catch (error) {
                    console.error('Search error:', error);
                    this.showError('Error searching for transaction. Please try again.');
                } finally {
                    this.hideLoading();
                }
            }

            displayBasicTransaction() {
                if (!this.currentTransaction) return;

                const transaction = this.currentTransaction;
                
                // Update basic info
                document.getElementById('infoReceiptNo').textContent = transaction.receiptNo;
                document.getElementById('infoDateTime').textContent = this.formatDateTime(transaction.date || transaction.createdAt);
                document.getElementById('infoCashier').textContent = transaction.cashier;
                
                const currency = transaction.currency || 'USD';
                const currencySymbol = currency === 'MVR' ? 'MVR ' : '$';
                document.getElementById('infoTotalAmount').textContent = `${currencySymbol}${transaction.grandTotal?.toFixed(2) || '0.00'}`;

                // Update only essential payment fields initially
                document.getElementById('selectPaymentType').value = transaction.paymentType || 'Card';
                document.getElementById('inputApprovalCode').value = transaction.approvalCode || '';
                document.getElementById('inputBatchNo').value = transaction.batchNo || '';
                document.getElementById('inputAmount').value = transaction.paid || transaction.grandTotal || 0;

                // Handle payment type specific fields
                this.handlePaymentTypeChange();

                // Hide all additional fields
                this.hideCustomerFields();
                this.hidePaymentDetailsFields();
                document.getElementById('fetchMessage').style.display = 'block';

                // Update receipt badge
                this.updateReceiptBadge();

                // Show transaction section
                this.showTransaction();

                // Show supervisor section if supervisor
                if (this.isSupervisor) {
                    this.showSupervisorSection();
                }

                // Reset data flags
                this.customerDataFetched = false;
                this.paymentDetailsFetched = false;
            }

            hideCustomerFields() {
                // Hide all customer fields
                const customerFields = [
                    'nameField', 'flightNoField', 'airlineField', 'seatNoField',
                    'adultsField', 'kidsField', 'rateTypeField', 'currencyField'
                ];
                
                customerFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.style.display = 'none';
                    }
                });
            }

            hidePaymentDetailsFields() {
                // Hide payment calculation fields
                const paymentDetailsFields = [
                    'subtotalField', 'gstField', 'grandTotalField', 'balanceField'
                ];
                
                paymentDetailsFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.style.display = 'none';
                    }
                });
            }

            showCustomerFields() {
                // Show all customer fields
                const customerFields = [
                    'nameField', 'flightNoField', 'airlineField', 'seatNoField',
                    'adultsField', 'kidsField', 'rateTypeField', 'currencyField'
                ];
                
                customerFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.style.display = 'block';
                    }
                });
            }

            showPaymentDetailsFields() {
                // Show payment calculation fields
                const paymentDetailsFields = [
                    'subtotalField', 'gstField', 'grandTotalField', 'balanceField'
                ];
                
                paymentDetailsFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.style.display = 'block';
                    }
                });
            }

            updateReceiptBadge() {
                const badge = document.getElementById('receiptBadge');
                if (!badge || !this.currentTransaction) return;
                
                if (this.currentTransaction.voided) {
                    badge.textContent = 'VOIDED';
                    badge.style.background = 'var(--danger)';
                } else if (this.currentTransaction.approvalCode) {
                    badge.textContent = 'APPROVED';
                    badge.style.background = 'var(--success)';
                } else {
                    badge.textContent = 'PENDING';
                    badge.style.background = 'var(--warning)';
                }
                badge.style.color = 'white';
            }

            fetchSelectedField() {
                if (!this.currentTransaction) return;

                const fieldSelector = document.getElementById('fieldSelector');
                const selectedField = fieldSelector?.value;

                if (!selectedField) {
                    this.showError('Please select a field to edit');
                    return;
                }

                this.processFieldSelection(selectedField);
            }

            async processFieldSelection(selectedField) {
                try {
                    // First, fetch the complete transaction data if not already done
                    if (!this.customerDataFetched && !this.paymentDetailsFetched) {
                        await this.fetchCompleteTransactionData();
                    }

                    // Enable the selected field(s) for editing
                    if (selectedField === 'all') {
                        this.enableAllFields();
                        this.showSuccess('All fields are now editable');
                    } else if (selectedField === 'paymentDetails') {
                        this.showPaymentDetailsFields();
                        this.showSuccess('Payment details are now visible');
                    } else {
                        this.enableSpecificField(selectedField);
                        this.showSuccess(`${this.getFieldLabel(selectedField)} is now editable`);
                    }

                    // Hide fetch message when fields are shown
                    if (selectedField !== 'paymentDetails') {
                        document.getElementById('fetchMessage').style.display = 'none';
                    }

                    // Reset selector
                    document.getElementById('fieldSelector').value = '';

                } catch (error) {
                    console.error('Error processing field selection:', error);
                    this.showError('Error fetching transaction data');
                }
            }

            async fetchCompleteTransactionData() {
                try {
                    // Re-fetch the complete transaction data
                    const doc = await this.walkinDb.collection('payments')
                        .doc(this.currentTransaction.id)
                        .get();

                    if (!doc.exists) {
                        throw new Error('Transaction not found');
                    }

                    const completeData = doc.data();
                    this.currentTransaction = {
                        ...this.currentTransaction,
                        ...completeData
                    };

                    // Update all fields with complete data
                    this.updateCustomerFields();
                    this.updatePaymentDetailsFields();
                    
                    this.customerDataFetched = true;
                    this.paymentDetailsFetched = true;

                } catch (error) {
                    console.error('Error fetching complete transaction data:', error);
                    throw error;
                }
            }

            updateCustomerFields() {
                if (!this.currentTransaction) return;

                const transaction = this.currentTransaction;
                
                // Update customer fields with complete data
                document.getElementById('inputName').value = transaction.name || '';
                document.getElementById('inputFlightNo').value = transaction.flightNo || '';
                document.getElementById('inputAirline').value = transaction.airline || '';
                document.getElementById('inputSeatNo').value = transaction.seatNo || '';
                document.getElementById('inputAdults').value = transaction.adults || 0;
                document.getElementById('inputKids').value = transaction.kids || 0;
                document.getElementById('inputRateType').value = transaction.rateType || 'A';
                document.getElementById('inputCurrency').value = transaction.currency || 'USD';
            }

            updatePaymentDetailsFields() {
                if (!this.currentTransaction) return;

                const transaction = this.currentTransaction;
                
                // Update payment calculation fields
                document.getElementById('inputSubtotal').value = transaction.subtotal || 0;
                document.getElementById('inputGst').value = transaction.gst || 0;
                document.getElementById('inputGrandTotal').value = transaction.grandTotal || 0;
                document.getElementById('inputBalance').value = transaction.balance || 0;
            }

            enableAllFields() {
                // Show all fields first
                this.showCustomerFields();
                this.showPaymentDetailsFields();

                // Enable all customer fields for editing
                const allFields = [
                    'inputName', 'inputFlightNo', 'inputAirline', 'inputSeatNo',
                    'inputAdults', 'inputKids', 'inputRateType', 'inputCurrency'
                ];
                
                allFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.readOnly = false;
                        field.disabled = false;
                    }
                });

                // Update field styling
                const allFieldContainers = [
                    'nameField', 'flightNoField', 'airlineField', 'seatNoField',
                    'adultsField', 'kidsField', 'rateTypeField', 'currencyField'
                ];
                
                allFieldContainers.forEach(fieldContainerId => {
                    const container = document.getElementById(fieldContainerId);
                    if (container) {
                        container.className = 'editable-field field-editable';
                    }
                });

                // Calculate totals when all fields are enabled
                this.calculateTotals();
            }

            enableSpecificField(fieldId) {
                const fieldMap = {
                    'name': { field: 'inputName', container: 'nameField' },
                    'flightNo': { field: 'inputFlightNo', container: 'flightNoField' },
                    'airline': { field: 'inputAirline', container: 'airlineField' },
                    'seatNo': { field: 'inputSeatNo', container: 'seatNoField' },
                    'adults': { field: 'inputAdults', container: 'adultsField' },
                    'kids': { field: 'inputKids', container: 'kidsField' },
                    'rateType': { field: 'inputRateType', container: 'rateTypeField' },
                    'currency': { field: 'inputCurrency', container: 'currencyField' }
                };

                const fieldInfo = fieldMap[fieldId];
                if (fieldInfo) {
                    const field = document.getElementById(fieldInfo.field);
                    const container = document.getElementById(fieldInfo.container);
                    
                    if (field && container) {
                        // Show the field
                        container.style.display = 'block';
                        field.readOnly = false;
                        field.disabled = false;
                        container.className = 'editable-field field-editable';
                    }
                }

                // If calculation-related fields are enabled, calculate totals
                if (['adults', 'kids', 'rateType', 'currency'].includes(fieldId)) {
                    this.calculateTotals();
                }
            }

            getFieldLabel(fieldId) {
                const labels = {
                    'name': 'Customer Name',
                    'flightNo': 'Flight Number',
                    'airline': 'Airline',
                    'seatNo': 'Seat Number',
                    'adults': 'Adults',
                    'kids': 'Kids',
                    'rateType': 'Rate Type',
                    'currency': 'Currency',
                    'paymentDetails': 'Payment Details',
                    'all': 'All Fields'
                };
                return labels[fieldId] || fieldId;
            }

            async saveTransaction() {
                if (!this.currentTransaction) return;

                // Validate before saving
                if (!this.validatePaymentFields()) {
                    return;
                }

                try {
                    const paymentType = document.getElementById('selectPaymentType').value;
                    const isCardPayment = paymentType !== 'Cash';

                    const updates = {
                        paymentType: paymentType,
                        paid: parseFloat(document.getElementById('inputAmount').value) || 0,
                        updatedAt: new Date()
                    };

                    // Only include card-specific fields for card payments
                    if (isCardPayment) {
                        updates.approvalCode = document.getElementById('inputApprovalCode').value.trim();
                        updates.batchNo = document.getElementById('inputBatchNo').value.trim();
                    } else {
                        // Clear card fields for cash payments
                        updates.approvalCode = '';
                        updates.batchNo = '';
                    }

                    // Only include customer fields if they were fetched and edited
                    if (this.customerDataFetched) {
                        updates.name = document.getElementById('inputName').value.trim();
                        updates.flightNo = document.getElementById('inputFlightNo').value.trim();
                        updates.airline = document.getElementById('inputAirline').value.trim();
                        updates.seatNo = document.getElementById('inputSeatNo').value.trim();
                        updates.adults = parseInt(document.getElementById('inputAdults').value) || 0;
                        updates.kids = parseInt(document.getElementById('inputKids').value) || 0;
                        updates.rateType = document.getElementById('inputRateType').value;
                        updates.currency = document.getElementById('inputCurrency').value;
                    }

                    // Include calculation fields if they were calculated
                    if (this.paymentDetailsFetched) {
                        updates.subtotal = parseFloat(document.getElementById('inputSubtotal').value) || 0;
                        updates.gst = parseFloat(document.getElementById('inputGst').value) || 0;
                        updates.grandTotal = parseFloat(document.getElementById('inputGrandTotal').value) || 0;
                        updates.balance = parseFloat(document.getElementById('inputBalance').value) || 0;
                    }

                    // Update in Firebase using your walkinDb
                    await this.walkinDb.collection('payments')
                        .doc(this.currentTransaction.id)
                        .update(updates);

                    // Update local transaction data
                    this.currentTransaction = {
                        ...this.currentTransaction,
                        ...updates
                    };

                    this.showSuccess('Transaction saved successfully!');
                    this.updateReceiptBadge();
                    
                } catch (error) {
                    console.error('Save error:', error);
                    this.showError('Error saving transaction. Please try again.');
                }
            }

            validatePaymentFields() {
                const paymentType = document.getElementById('selectPaymentType').value;
                const isCardPayment = paymentType !== 'Cash';
                const approvalCode = document.getElementById('inputApprovalCode')?.value?.trim();
                const batchNo = document.getElementById('inputBatchNo')?.value?.trim();
                const amount = parseFloat(document.getElementById('inputAmount').value) || 0;
                const grandTotal = parseFloat(document.getElementById('inputGrandTotal').value) || parseFloat(this.currentTransaction?.grandTotal) || 0;

                // Validate card-specific fields
                if (isCardPayment) {
                    if (!approvalCode) {
                        this.showToast('Approval code is required for card payments', 'warning');
                        return false;
                    }

                    if (!batchNo) {
                        this.showToast('Batch number is required for card payments', 'warning');
                        return false;
                    }
                }

                // Validate amount
                if (amount <= 0) {
                    this.showToast('Please enter a valid amount paid', 'warning');
                    return false;
                }

                // For card payments, amount must equal grand total
                if (isCardPayment && amount !== grandTotal) {
                    this.showToast('For card payments, amount paid must equal grand total', 'warning');
                    return false;
                }

                // For cash payments, amount must be at least grand total
                if (!isCardPayment && amount < grandTotal) {
                    this.showToast('Amount paid cannot be less than grand total', 'warning');
                    return false;
                }

                return true;
            }

            showVoidModal() {
                if (!this.currentTransaction) return;

                if (this.currentTransaction.voided) {
                    this.showError('Transaction is already voided');
                    return;
                }

                // Only supervisors can void transactions
                if (!this.isSupervisor) {
                    this.showError('Only supervisors can void transactions');
                    return;
                }

                document.getElementById('voidReason').value = '';
                document.getElementById('voidModal').style.display = 'flex';
            }

            hideAllModals() {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.style.display = 'none';
                });
            }

            async voidTransaction() {
                const voidReason = document.getElementById('voidReason').value.trim();
                
                if (!voidReason) {
                    this.showError('Please provide a reason for voiding the transaction');
                    return;
                }

                try {
                    await this.walkinDb.collection('payments')
                        .doc(this.currentTransaction.id)
                        .update({
                            voided: true,
                            voidedAt: new Date(),
                            voidedBy: this.currentUser.username,
                            voidReason: voidReason
                        });

                    // Update local data
                    this.currentTransaction.voided = true;
                    this.currentTransaction.voidedAt = new Date();
                    this.currentTransaction.voidReason = voidReason;

                    this.showSuccess('Transaction voided successfully!');
                    this.updateReceiptBadge();
                    this.hideAllModals();
                    
                } catch (error) {
                    console.error('Void error:', error);
                    this.showError('Error voiding transaction. Please try again.');
                }
            }

            formatDateTime(dateValue) {
                if (!dateValue) return '-';
                
                try {
                    const date = dateValue.toDate ? dateValue.toDate() : new Date(dateValue);
                    return date.toLocaleString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                } catch (error) {
                    return '-';
                }
            }

            resetSearch() {
                document.getElementById('receiptSearch').value = '';
                this.currentTransaction = null;
                this.hideTransaction();
                this.hideEmptyState();
                this.hideSupervisorSection();
                this.focusSearch();
                this.hasSupervisorAccess = false;
                this.customerDataFetched = false;
                this.paymentDetailsFetched = false;
            }

            // UI State Management
            showLoading() {
                document.getElementById('loadingState').style.display = 'block';
            }

            hideLoading() {
                document.getElementById('loadingState').style.display = 'none';
            }

            showTransaction() {
                document.getElementById('transactionSection').style.display = 'block';
            }

            hideTransaction() {
                document.getElementById('transactionSection').style.display = 'none';
            }

            showSupervisorSection() {
                document.getElementById('supervisorSection').style.display = 'block';
            }

            hideSupervisorSection() {
                document.getElementById('supervisorSection').style.display = 'none';
            }

            showEmptyState() {
                document.getElementById('emptyState').style.display = 'block';
            }

            hideEmptyState() {
                document.getElementById('emptyState').style.display = 'none';
            }

            showError(message) {
                this.showToast(message, 'error');
            }

            showSuccess(message) {
                this.showToast(message, 'success');
            }

            showToast(message, type = 'success') {
                // Remove existing toasts
                const existingToasts = document.querySelectorAll('.toast');
                existingToasts.forEach(toast => toast.remove());

                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                document.body.appendChild(toast);

                // Show toast
                setTimeout(() => toast.classList.add('show'), 100);

                // Hide toast after 3 seconds
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            new PaymentApproval();
        });
    </script>
</body>
</html>